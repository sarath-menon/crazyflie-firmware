# Crazyflie Firmware with CMake build [![CI](https://github.com/bitcraze/crazyflie-firmware/workflows/CI/badge.svg)](https://github.com/bitcraze/crazyflie-firmware/actions?query=workflow%3ACI)

Crazyflie firmware with CMake based build.

The relevant files are:

1. cmake/gcc-arm-none-eabi.cmake - compiler settings
2. cmake/board.cmake - microcontroller settings
3. cmake/all_libs.cmake - paths to static libraries

The key modifications are:

1. New linker script (modified from the autogenerated linker script by STM32 file)
2. Additonal functions in log.h to support logging from C++ files

Note: KConfig is not supported right now. Instead, the autogenerated autoconf.h from the default config has been added to src/config

## Building and Flashing

1. Follow the [official bitcraze installation instructions](https://github.com/bitcraze/crazyflie-firmware/blob/master/docs/building-and-flashing/build.md) to install the compiler ,ie, eveything before the section cloning

2. Clone the repository

```
https://github.com/sarath-menon/crazyflie-firmware.git
```

3. Set the appropriate compiler path in line 12 of cmake/gcc-arm-none-eabi.cmake

4. Build using cmake

- Instructions for ninja generator (preferred)

```
cmake -Bbuild -GNinja
ninja -Cbuild
```

- Instructions for make generator

```
cmake -Bbuild
make -Cbuild
```

## Flashing

All Openocd/Jlink related functionality for flashing and debugging is retained in the makefile. Eg. to flash the firmware using the debugger,

```
make flash
```
